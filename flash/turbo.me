#
# Adobe FlashPlayer turbo.me file
# https://github.com/turboapps/turbome/tree/master/flash
#
# Created with Turbo CMD version 1.4.1171.0
#
# Licensed under the Apache License, Version 2.0
# http://www.apache.org/licenses/LICENSE-2.0

###################################
# Meta tags
###################################

meta title="Adobe FlashPlayer"
meta namespace="adobe"
meta name="flash"

###################################
# Pull dependency images
###################################

using gnu/wget,python/python:3.4.1



###################################
# Download and install
###################################

# Set working directory
cmd mkdir c:\Workspace
workdir c:\Workspace

# Get version
cmd pip install requests --quiet

batch
 echo import sys > getRelease.py
 echo import requests >> getRelease.py
 echo import re >> getRelease.py
 echo host = 'http://www.adobe.com/support/flashplayer/downloads.html' >> getRelease.py
 echo headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.3; WOW64; rv:41.0) Gecko/20100101 Firefox/41.0'} >>  getRelease.py
 echo r = requests.get(host , headers=headers, timeout=10) >> getRelease.py
 echo print(re.findall('(\d*\.\d*.\d*\.\d*) \(Win and Mac\)', r.text)[0]) >> getRelease.py

cmd python getRelease.py

var tag = last

cmd "python -c ""print('%tag%'.split('.')[0])"""
var version = last

# Download
cmd "wget -O setup.msi --no-check-certificate http://download.macromedia.com/get/flashplayer/current/licensing/win/install_flash_player_%version%_plugin.msi"

# Install
cmd "setup.msi /qn"


###################################
# Environment Variables
###################################


###################################
# Clean up
###################################

workdir c:\

cmd rmdir c:\Workspace /s /q
cmd rmdir c:\wget /s /q
cmd rmdir c:\Python34 /s /q

###################################
# Version
###################################

meta tag=tag
meta version=tag


###################################
# Startup File
###################################
